# Codex Delegate — Copilot Code Generation Instructions

Use this doc as the authoritative guide when generating or editing code in this repository.

- **Canonical style & rules:** See `docs/code-style.md` (JSDoc required for exported and non-trivial functions/classes; explicit return types; avoid `any`). ✅
- **Language & tooling:** TypeScript (strict), Vitest for tests, Prettier for formatting, ESLint for linting, Husky + lint-staged for pre-commit hooks.

Key scripts (run from repo root):

- `npm run test` — run Vitest
- `npm run test:watch` — watch tests
- `npm run test:cov` — coverage report
- `npm run build` — `tsc -p .`
- `npm run lint` / `npm run lint:fix`
- `npm run format` / `npm run prettier:check`
- `npm run lint:md` — markdownlint

Behavioral rules for generated code:

- Always follow `docs/code-style.md` first. Add or update JSDoc for every exported function/class and for any non-trivial helpers (`@param`, `@returns`, `@remarks`, `@example`).
- Prefer explicit types and return types. Do **not** introduce `any`; use `unknown` + narrowing if needed.
- Add a **Vitest** unit test for new or changed behavior. Prefer colocated tests (e.g., `foo.spec.ts` next to `foo.ts`).
- Keep imports ordered and lint-friendly. Run `npm run lint` and `npm run format` mentally when suggesting changes.
- When adding or changing public API, update `src/index.ts` exports, `package.json` type export if needed, and mention the change in docs/README with an example.

When producing diffs or code snippets:

- Provide a one-line rationale for the change (why).
- Include a short test stub demonstrating expected behavior and edge cases.
- Ensure suggested code passes linting/formatting rules and includes JSDoc.

Prompt examples you can use with me:

- "Add an exported function `foo` that does X: include JSDoc, a `vitest` test, and export in `src/index.ts`."
- "Refactor `bar` to improve typing and add unit tests; ensure ESLint rules and JSDoc are satisfied."
- "Write a small example for README showing how to call `baz` and mock the SDK in tests."

> Quick note: if a rule is ambiguous, prefer strict typing and clear JSDoc. Thank you!
